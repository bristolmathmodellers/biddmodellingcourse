<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solutions 3: Compartmental Models to Equations â€¢ BIDD Modelling Course</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/lumen/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Solutions 3: Compartmental Models to Equations">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BIDD Modelling Course</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Practicals
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/practical-one.html">Practical 1 - Designing a Model</a>
    </li>
    <li>
      <a href="../articles/practical-two.html">Practical 2 - Exloring Compartmental Model Dynamics</a>
    </li>
    <li>
      <a href="../articles/practical-three.html">Practical 3 - Compartmental Models to Equations</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Solutions
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/solutions-one.html">Solutions 1 - Designing a Model</a>
    </li>
    <li>
      <a href="../articles/solutions-two.html">Solutions 2 - Exloring Compartmental Model Dynamics</a>
    </li>
    <li>
      <a href="../articles/solutions-three.html">Solutions 3 - Compartmental Models to Equations</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Fact Sheets
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tb-fact-sheet.html">Tuberculosis</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://www.seabbs.co.uk/shiny/exploreidmodels/">Explore ID Models Interactively</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="https://github.com/bristolmathmodellers/biddmodellingcourse/">
    <span class="fa fa-github fa-lg"></span>
     
    Github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Solutions 3: Compartmental Models to Equations</h1>
                        <h4 class="author">Sam Abbott</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bristolmathmodellers/biddmodellingcourse/blob/master/vignettes/solutions-three.Rmd"><code>vignettes/solutions-three.Rmd</code></a></small>
      <div class="hidden name"><code>solutions-three.Rmd</code></div>

    </div>

    
    
<div id="learning-objectives" class="section level1">
<h1 class="hasAnchor">
<a href="#learning-objectives" class="anchor"></a>Learning Objectives</h1>
<ol style="list-style-type: decimal">
<li>Know how to translate a simple model flow diagram into equations.</li>
<li>Know how to use a simple model scaffold to develop a more complex model.</li>
<li>Understand how to implement your own model structure.</li>
</ol>
</div>
<div id="outline-for-session" class="section level1">
<h1 class="hasAnchor">
<a href="#outline-for-session" class="anchor"></a>Outline for Session</h1>
<ol style="list-style-type: decimal">
<li>Set up (5 minutes)</li>
<li>Practise simulating a fully implemented SEIR model (10 minutes).</li>
<li>Add high and low risk latency to the SEIR model (10 minutes).</li>
<li>Translate a more realistic SHLIR model flow diagram to equations (10 minutes).</li>
<li>Implement your own model into R (20 minutes).</li>
<li>Session wrap up (5 minutes)</li>
</ol>
</div>
<div id="solutions" class="section level1">
<h1 class="hasAnchor">
<a href="#solutions" class="anchor"></a>Solutions</h1>
<p>The practical solutions are in <strong>bold</strong>, all code has been completed and the exercise models have been simmulated and summarised.</p>
</div>
<div id="exercise" class="section level1">
<h1 class="hasAnchor">
<a href="#exercise" class="anchor"></a>Exercise</h1>
<p>##1. A Simple SEIR Model of Tuberculosis (TB)</p>
<p>As a first exercise we are going to run the simple SEIR model, as seen in practical 2, in R. If you have not installed the course package do this now with the following <code>R</code> code (speak to an instructor if you are having issues with this step).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"devtools"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"bristolmathmodellers/biddmodellingcourse"</span>)</a></code></pre></div>
<p>Now load the course package,</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(biddmodellingcourse)</a></code></pre></div>
<p>For more help getting started see the course README (<a href="https://bristolmathmodellers.github.io/biddmodellingcourse/" class="uri">https://bristolmathmodellers.github.io/biddmodellingcourse/</a>) or ask an instructor.</p>
<div id="populations-and-initialisation" class="section level3">
<h3 class="hasAnchor">
<a href="#populations-and-initialisation" class="anchor"></a>Populations and Initialisation</h3>
<p>We first set up the initial populations for the Susceptible (<span class="math inline">\(S_0\)</span>), Latent (<span class="math inline">\(E_0\)</span>), Infected (<span class="math inline">\(I\)</span>), and Recovered (<span class="math inline">\(R\)</span>) compartments. We have initialised the model as an early stage epidemic with a single case of TB.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">inits =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  <span class="dt">S =</span> <span class="dv">999</span>,</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="dt">E =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  <span class="dt">I =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">  <span class="dt">R =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">)</a></code></pre></div>
</div>
<div id="parameters" class="section level3">
<h3 class="hasAnchor">
<a href="#parameters" class="anchor"></a>Parameters</h3>
<p>We then specify the model parameters (with the units being years<sup>-1</sup>), varying these parameters will impact the model dynamics.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">parameters &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="dt">beta =</span> <span class="dv">3</span>, <span class="co"># Rate of transmission</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="dt">gamma =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="co"># Rate of progression to active symptoms </span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  <span class="dt">tau =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="co"># Rate of recovery</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="dt">mu =</span> <span class="dv">0</span> <span class="co"># Rate of natural mortality</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">)</a></code></pre></div>
</div>
<div id="equations" class="section level3">
<h3 class="hasAnchor">
<a href="#equations" class="anchor"></a>Equations</h3>
<p>Finally we specify the model equations for each population compartment. This model incorporates simple demographic processes with a constant natural death rate from all compartments which is equal to the birth rate into the susceptible compartment.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">SEIR_demo_ode &lt;-<span class="st"> </span><span class="cf">function</span>(t, x, params) {</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">  ## Specify model compartments</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  S &lt;-<span class="st"> </span>x[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  E &lt;-<span class="st"> </span>x[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">  I &lt;-<span class="st"> </span>x[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">  R &lt;-<span class="st"> </span>x[<span class="dv">4</span>]</a>
<a class="sourceLine" id="cb5-8" data-line-number="8"></a>
<a class="sourceLine" id="cb5-9" data-line-number="9">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">as.list</a></span>(params),{</a>
<a class="sourceLine" id="cb5-10" data-line-number="10"></a>
<a class="sourceLine" id="cb5-11" data-line-number="11">    ## Specify total population</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">    N =<span class="st"> </span>S <span class="op">+</span><span class="st"> </span>E <span class="op">+</span><span class="st"> </span>I <span class="op">+</span><span class="st"> </span>R</a>
<a class="sourceLine" id="cb5-13" data-line-number="13"></a>
<a class="sourceLine" id="cb5-14" data-line-number="14">    ## Derivative Expressions</a>
<a class="sourceLine" id="cb5-15" data-line-number="15">    dS =<span class="st"> </span><span class="op">-</span>beta <span class="op">*</span><span class="st"> </span>S <span class="op">*</span><span class="st"> </span>I <span class="op">/</span><span class="st"> </span>N <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>S <span class="op">+</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>N</a>
<a class="sourceLine" id="cb5-16" data-line-number="16">    dE =<span class="st"> </span>beta <span class="op">*</span><span class="st"> </span>S <span class="op">*</span><span class="st"> </span>I <span class="op">/</span><span class="st"> </span>N <span class="op">-</span><span class="st"> </span>gamma <span class="op">*</span><span class="st"> </span>E <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>E</a>
<a class="sourceLine" id="cb5-17" data-line-number="17">    dI =<span class="st"> </span>gamma <span class="op">*</span><span class="st"> </span>E <span class="op">-</span><span class="st"> </span>tau <span class="op">*</span><span class="st"> </span>I <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>I</a>
<a class="sourceLine" id="cb5-18" data-line-number="18">    dR =<span class="st"> </span>tau <span class="op">*</span><span class="st"> </span>I <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>R</a>
<a class="sourceLine" id="cb5-19" data-line-number="19"></a>
<a class="sourceLine" id="cb5-20" data-line-number="20">    ## output</a>
<a class="sourceLine" id="cb5-21" data-line-number="21">    derivatives &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(dS, dE, dI, dR)</a>
<a class="sourceLine" id="cb5-22" data-line-number="22"></a>
<a class="sourceLine" id="cb5-23" data-line-number="23">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(derivatives)</a>
<a class="sourceLine" id="cb5-24" data-line-number="24">  })</a>
<a class="sourceLine" id="cb5-25" data-line-number="25">}</a></code></pre></div>
</div>
<div id="simulate-and-summarise" class="section level3">
<h3 class="hasAnchor">
<a href="#simulate-and-summarise" class="anchor"></a>Simulate and Summarise</h3>
<p>To simulate the model we specify the starting year (<code>begin_time</code>) and final year (<code>end_time</code>) and define a sequence over all intervening years. The model is then solved using <code><a href="https://www.rdocumentation.org/packages/deSolve/topics/lsoda">deSolve::lsoda</a></code> which is used within a simple wrapper function (see <code><a href="../reference/solve_ode.html">?solve_ode</a></code> for details). The resulting table summarises the simulation results for the first 5 years.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">begin_time &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">end_time &lt;-<span class="st"> </span><span class="dv">200</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3">times &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(begin_time, end_time, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb6-4" data-line-number="4"></a>
<a class="sourceLine" id="cb6-5" data-line-number="5">## see ?solve_ode for details</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">SEIR_sim &lt;-<span class="st"> </span>biddmodellingcourse<span class="op">::</span><span class="kw"><a href="https://bristolmathmodellers.github.io/biddmodellingcourse//reference/solve_ode.html">solve_ode</a></span>(<span class="dt">model =</span> SEIR_demo_ode, </a>
<a class="sourceLine" id="cb6-7" data-line-number="7">                                           <span class="dt">inits =</span> inits, </a>
<a class="sourceLine" id="cb6-8" data-line-number="8">                                           <span class="dt">params =</span> parameters,</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">                                           <span class="dt">times =</span> times, </a>
<a class="sourceLine" id="cb6-10" data-line-number="10">                                           <span class="dt">as.data.frame =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb6-11" data-line-number="11">SEIR_sim <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="st">  </span>head <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="../reference/pretty_table.html">pretty_table</a></span>(<span class="dt">caption =</span> <span class="st">"First 5 years of model simulation"</span>,</a>
<a class="sourceLine" id="cb6-14" data-line-number="14">               <span class="dt">label =</span> <span class="st">"tab-1"</span>)</a></code></pre></div>
<table class="table">
<caption>Table 1: First 5 years of model simulation</caption>
<colgroup>
<col width="9%">
<col width="11%">
<col width="11%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center">time</th>
<th align="center">S</th>
<th align="center">E</th>
<th align="center">I</th>
<th align="center">R</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">999</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">996.4</td>
<td align="center">2.334</td>
<td align="center">0.8182</td>
<td align="center">0.4317</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">993.7</td>
<td align="center">4.359</td>
<td align="center">1.033</td>
<td align="center">0.8823</td>
</tr>
<tr class="even">
<td align="center">3</td>
<td align="center">990</td>
<td align="center">6.976</td>
<td align="center">1.524</td>
<td align="center">1.51</td>
</tr>
<tr class="odd">
<td align="center">4</td>
<td align="center">984.4</td>
<td align="center">10.84</td>
<td align="center">2.33</td>
<td align="center">2.458</td>
</tr>
<tr class="even">
<td align="center">5</td>
<td align="center">975.8</td>
<td align="center">16.69</td>
<td align="center">3.586</td>
<td align="center">3.915</td>
</tr>
</tbody>
</table>
<p>We then summarise the epidemic peak (<code>epi_peak</code>) and epidemic duration (<code>epi_dur</code>), along with population sizes at the end of the time period simulated.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">biddmodellingcourse<span class="op">::</span><span class="kw"><a href="https://bristolmathmodellers.github.io/biddmodellingcourse//reference/summarise_model.html">summarise_model</a></span>(SEIR_sim) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pretty_table.html">pretty_table</a></span>(<span class="dt">caption =</span> <span class="st">"SEIR model summary statistics; The final size of each population at the end of the simulation, along with the time the epidemic peak was reached, the number of infected at the epidemic peak and the duration of the epidemic"</span>)</a></code></pre></div>
<table class="table">
<caption>Table 2: SEIR model summary statistics; The final size of each population at the end of the simulation, along with the time the epidemic peak was reached, the number of infected at the epidemic peak and the duration of the epidemic (continued below)</caption>
<colgroup>
<col width="22%">
<col width="22%">
<col width="22%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th align="center">Final size: S</th>
<th align="center">Final size: E</th>
<th align="center">Final size: I</th>
<th align="center">Final size: R</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">3</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">997</td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="29%">
<col width="22%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th align="center">Epidemic peak time</th>
<th align="center">Epidemic peak</th>
<th align="center">Epidemic duration</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">18</td>
<td align="center">145</td>
<td align="center">200</td>
</tr></tbody>
</table>
<p>Finally we plot the population in each model compartment over time.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">## For an interactive graph change interactive to TRUE</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">## Interactivity allows plot zooming and gives a tool tip providing the population sizr at any point.</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">biddmodellingcourse<span class="op">::</span><span class="kw"><a href="https://bristolmathmodellers.github.io/biddmodellingcourse//reference/plot_model.html">plot_model</a></span>(SEIR_sim, <span class="dt">interactive =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="solutions-three_files/figure-html/seir-plot-1.png" alt="Figure 1: Plot of population over time in each SEIR model compartment" width="2310"><p class="caption">
Figure 1: Plot of population over time in each SEIR model compartment
</p>
</div>
</div>
<div id="explore" class="section level3">
<h3 class="hasAnchor">
<a href="#explore" class="anchor"></a>Explore</h3>
<p>As we saw in practical 2, model dynamics are parameter dependent. Look back at the questions from practical 2 and check that you can implement the changes in the code above to answer them.</p>
<p>#2. Add High and Low Risk Compartments</p>
<p>Now we are going to implement the SHLIR model from practical 2 and try to reproduce some of the behaviour observed using the interactive interface. See practical for details on this model.</p>
</div>
<div id="populations-and-initialisation-1" class="section level3">
<h3 class="hasAnchor">
<a href="#populations-and-initialisation-1" class="anchor"></a>Populations and Initialisation</h3>
<p>As in the previous model the first step is to define the model populations. There are now two new compartments, high risk latents (H), and low risk latents (L). These replace the original latent population (E) used in the SEIR model.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">SHLIR_inits =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  <span class="dt">S =</span> <span class="dv">999</span>,</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">  <span class="dt">H =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">  <span class="dt">L =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  <span class="dt">I =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  <span class="dt">R =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">)</a></code></pre></div>
</div>
<div id="parameters-1" class="section level3">
<h3 class="hasAnchor">
<a href="#parameters-1" class="anchor"></a>Parameters</h3>
<p>We add two additional parameters for the rate of progression from high to low risk latents (<code>nu</code>) and the rate of progression from low risk latent to active disease (<code>gamma_L</code>).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">SHLIR_parameters &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">  <span class="dt">beta =</span> <span class="dv">3</span>, <span class="co"># Rate of transmission</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3">  <span class="dt">gamma_H =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="co"># Rate of progression to active symptoms from high risk latent</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">  <span class="dt">nu =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="co">#Rate of progression from high to low risk latent</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5">  <span class="dt">gamma_L =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">100</span>, <span class="co"># Rate of progression to active symptoms for low risk latent</span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6">  <span class="dt">tau =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="co"># Rate of recovery</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7">  <span class="dt">mu =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">81</span> <span class="co"># Rate of natural mortality</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8">)</a></code></pre></div>
</div>
<div id="equations-1" class="section level3">
<h3 class="hasAnchor">
<a href="#equations-1" class="anchor"></a>Equations</h3>
<p>The code below is a starting point, fill in the missing model terms using the model flow diagram (Figure 2) and the code for the previous SEIR model as reference points.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">SHLIR_demo_ode &lt;-<span class="st"> </span><span class="cf">function</span>(t, x, params) {</a>
<a class="sourceLine" id="cb11-2" data-line-number="2"></a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  ## Specify model compartments</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  S &lt;-<span class="st"> </span>x[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">  H &lt;-<span class="st"> </span>x[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">  L &lt;-<span class="st"> </span>x[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">  I &lt;-<span class="st"> </span>x[<span class="dv">4</span>]</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">  R &lt;-<span class="st"> </span>x[<span class="dv">5</span>]</a>
<a class="sourceLine" id="cb11-9" data-line-number="9"></a>
<a class="sourceLine" id="cb11-10" data-line-number="10">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">as.list</a></span>(params),{</a>
<a class="sourceLine" id="cb11-11" data-line-number="11"></a>
<a class="sourceLine" id="cb11-12" data-line-number="12">    ## Specify total population</a>
<a class="sourceLine" id="cb11-13" data-line-number="13">    N =<span class="st"> </span>S <span class="op">+</span><span class="st"> </span>H <span class="op">+</span><span class="st"> </span>L <span class="op">+</span><span class="st"> </span>I <span class="op">+</span><span class="st"> </span>R</a>
<a class="sourceLine" id="cb11-14" data-line-number="14"></a>
<a class="sourceLine" id="cb11-15" data-line-number="15">    ## Derivative Expressions</a>
<a class="sourceLine" id="cb11-16" data-line-number="16">    dS =<span class="st"> </span><span class="op">-</span><span class="st"> </span>beta <span class="op">*</span><span class="st"> </span>S <span class="op">*</span><span class="st"> </span>I <span class="op">/</span><span class="st"> </span>N <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>S <span class="op">+</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>N</a>
<a class="sourceLine" id="cb11-17" data-line-number="17">    ## These are the new equations - fill in the remaining terms</a>
<a class="sourceLine" id="cb11-18" data-line-number="18">    dH =<span class="st"> </span>beta <span class="op">*</span><span class="st"> </span>(S <span class="op">+</span><span class="st"> </span>L) <span class="op">*</span><span class="st"> </span>I <span class="op">/</span><span class="st"> </span>N <span class="op">-</span><span class="st"> </span>gamma_H <span class="op">*</span><span class="st"> </span>H <span class="op">-</span><span class="st"> </span>nu <span class="op">*</span><span class="st"> </span>H <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>H</a>
<a class="sourceLine" id="cb11-19" data-line-number="19">    dL =<span class="st"> </span>nu <span class="op">*</span><span class="st"> </span>H <span class="op">-</span><span class="st"> </span>beta <span class="op">*</span><span class="st"> </span>L <span class="op">*</span><span class="st"> </span>I <span class="op">/</span><span class="st"> </span>N <span class="op">-</span><span class="st"> </span>gamma_L <span class="op">*</span><span class="st"> </span>L <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>L</a>
<a class="sourceLine" id="cb11-20" data-line-number="20">    ## Hint terms are missing from this equation as well</a>
<a class="sourceLine" id="cb11-21" data-line-number="21">    dI =<span class="st"> </span>gamma_H <span class="op">*</span><span class="st"> </span>H <span class="op">+</span><span class="st"> </span>gamma_L <span class="op">*</span><span class="st"> </span>L <span class="op">-</span><span class="st"> </span>tau <span class="op">*</span><span class="st"> </span>I <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>I</a>
<a class="sourceLine" id="cb11-22" data-line-number="22">    dR =<span class="st"> </span>tau <span class="op">*</span><span class="st"> </span>I <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>R</a>
<a class="sourceLine" id="cb11-23" data-line-number="23"></a>
<a class="sourceLine" id="cb11-24" data-line-number="24">    ## output</a>
<a class="sourceLine" id="cb11-25" data-line-number="25">    derivatives &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(dS, dH, dL, dI, dR)</a>
<a class="sourceLine" id="cb11-26" data-line-number="26"></a>
<a class="sourceLine" id="cb11-27" data-line-number="27">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(derivatives)</a>
<a class="sourceLine" id="cb11-28" data-line-number="28">  })</a>
<a class="sourceLine" id="cb11-29" data-line-number="29">}</a></code></pre></div>
</div>
<div id="simulate-and-summarise-1" class="section level3">
<h3 class="hasAnchor">
<a href="#simulate-and-summarise-1" class="anchor"></a>Simulate and Summarise</h3>
<p>Simulation is the same as for the previous model. Does the simulation of your improved model make sense? Evaluate the summary tables and plot of model populations over time.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">begin_time &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">end_time &lt;-<span class="st"> </span><span class="dv">200</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3">SHILR_times &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(begin_time, end_time, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"></a>
<a class="sourceLine" id="cb12-5" data-line-number="5">## see ?solve_ode for details</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">SHLIR_sim &lt;-<span class="st"> </span>biddmodellingcourse<span class="op">::</span><span class="kw"><a href="https://bristolmathmodellers.github.io/biddmodellingcourse//reference/solve_ode.html">solve_ode</a></span>(<span class="dt">model =</span> SHLIR_demo_ode, </a>
<a class="sourceLine" id="cb12-7" data-line-number="7">                                           <span class="dt">inits =</span> SHLIR_inits, </a>
<a class="sourceLine" id="cb12-8" data-line-number="8">                                           <span class="dt">params =</span> SHLIR_parameters,</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">                                           <span class="dt">times =</span> SHILR_times, </a>
<a class="sourceLine" id="cb12-10" data-line-number="10">                                           <span class="dt">as.data.frame =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb12-11" data-line-number="11">SHLIR_sim <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="st">  </span>head <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="../reference/pretty_table.html">pretty_table</a></span>(<span class="dt">caption =</span> <span class="st">"First 5 years of SHLIR model simulation"</span>,</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">               <span class="dt">label =</span> <span class="st">"tab-1"</span>)</a></code></pre></div>
<table class="table">
<caption>Table 1: First 5 years of model simulation</caption>
<colgroup>
<col width="9%">
<col width="11%">
<col width="11%">
<col width="12%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="center">time</th>
<th align="center">S</th>
<th align="center">H</th>
<th align="center">L</th>
<th align="center">I</th>
<th align="center">R</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">999</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">996.5</td>
<td align="center">1.794</td>
<td align="center">0.5224</td>
<td align="center">0.7773</td>
<td align="center">0.4223</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">994.2</td>
<td align="center">2.576</td>
<td align="center">1.606</td>
<td align="center">0.8263</td>
<td align="center">0.8098</td>
</tr>
<tr class="even">
<td align="center">3</td>
<td align="center">991.6</td>
<td align="center">3.186</td>
<td align="center">2.99</td>
<td align="center">0.9684</td>
<td align="center">1.243</td>
</tr>
<tr class="odd">
<td align="center">4</td>
<td align="center">988.6</td>
<td align="center">3.853</td>
<td align="center">4.648</td>
<td align="center">1.164</td>
<td align="center">1.756</td>
</tr>
<tr class="even">
<td align="center">5</td>
<td align="center">984.9</td>
<td align="center">4.653</td>
<td align="center">6.621</td>
<td align="center">1.411</td>
<td align="center">2.372</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">biddmodellingcourse<span class="op">::</span><span class="kw"><a href="https://bristolmathmodellers.github.io/biddmodellingcourse//reference/summarise_model.html">summarise_model</a></span>(SHLIR_sim) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pretty_table.html">pretty_table</a></span>(<span class="dt">caption =</span> <span class="st">"SHLIR model summary statistics; The final size of each population at the end of the simulation, along with the time the epidemic peak was reached, the number of infected at the epidemic peak and the duration of the epidemic"</span>)</a></code></pre></div>
<table class="table">
<caption>Table 3: SHLIR model summary statistics; The final size of each population at the end of the simulation, along with the time the epidemic peak was reached, the number of infected at the epidemic peak and the duration of the epidemic (continued below)</caption>
<colgroup>
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="center">Final size: S</th>
<th align="center">Final size: H</th>
<th align="center">Final size: L</th>
<th align="center">Final size: I</th>
<th align="center">Final size: R</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">238</td>
<td align="center">24</td>
<td align="center">194</td>
<td align="center">13</td>
<td align="center">531</td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="29%">
<col width="22%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th align="center">Epidemic peak time</th>
<th align="center">Epidemic peak</th>
<th align="center">Epidemic duration</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">32</td>
<td align="center">57</td>
<td align="center">1</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">## For an interactive graph change interactive to TRUE</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">biddmodellingcourse<span class="op">::</span><span class="kw"><a href="https://bristolmathmodellers.github.io/biddmodellingcourse//reference/plot_model.html">plot_model</a></span>(SHLIR_sim, <span class="dt">interactive =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="solutions-three_files/figure-html/shlir-plot-1.png" alt="Figure 3: Plot of the population in each SHLIR model compartment over time" width="2310"><p class="caption">
Figure 3: Plot of the population in each SHLIR model compartment over time
</p>
</div>
</div>
<div id="explore-1" class="section level3">
<h3 class="hasAnchor">
<a href="#explore-1" class="anchor"></a>Explore</h3>
<ol style="list-style-type: decimal">
<li>
<p>Test your changes by setting <code>nu = 0</code> and all other parameters to be the same as for the SEIR model. If everything is working correctly both models should give the same output.</p>
<ul>
<li><strong>The SEIR and SHLIR models should give the same result.</strong></li>
<li><strong>This works because when <code>nu = 0</code> no one enters the low risk latent population compartment and therefore it has no effect.</strong></li>
</ul>
</li>
<li><p>Can you alter the parameters defined above to answer the questions for this model from practical 2?</p></li>
</ol>
<p>##3. Translate a more realistic SHLIR model flow diagram to equations</p>
<p>As a more advanced exercise (<em>feel free to skip this if wanting to design your own model now</em>) we now translate the more complex SHLIR model into code. Look back at practical 2 for a refresher on the structure of this model.</p>
</div>
<div id="populations-and-initialisation-2" class="section level3">
<h3 class="hasAnchor">
<a href="#populations-and-initialisation-2" class="anchor"></a>Populations and Initialisation</h3>
<p>The new populations have been added for you. The population has now been split between low and high risk populations, with the only infectious case being in the high risk population.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">real_SHLIR_inits =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">  <span class="co"># General population</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3">  <span class="dt">S =</span> <span class="dv">800</span>,</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">  <span class="dt">H =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">  <span class="dt">L =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">  <span class="dt">I =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">  <span class="dt">Tr =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">  <span class="dt">R =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">  ## High risk population</a>
<a class="sourceLine" id="cb15-10" data-line-number="10">  <span class="dt">S_H =</span> <span class="dv">199</span>,</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">  <span class="dt">H_H =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb15-12" data-line-number="12">  <span class="dt">L_H =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb15-13" data-line-number="13">  <span class="dt">I_H =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb15-14" data-line-number="14">  <span class="dt">Tr_H =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb15-15" data-line-number="15">  <span class="dt">R_H =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb15-16" data-line-number="16">)</a></code></pre></div>
</div>
<div id="parameters-2" class="section level3">
<h3 class="hasAnchor">
<a href="#parameters-2" class="anchor"></a>Parameters</h3>
<p>The required model parameters have been defined for you (with the units being years<sup>-1</sup>). The only new parameters are the between group mixing (<code>M</code>), the proportion that are born high risk (<code>p</code>), and the transmission probability in those considered to be high risk (<code>beta_H</code>).</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">real_SHLIR_parameters &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">  <span class="dt">beta =</span> <span class="dv">3</span>, <span class="co"># Rate of transmission</span></a>
<a class="sourceLine" id="cb16-3" data-line-number="3">  <span class="dt">beta_H =</span> <span class="dv">6</span>, <span class="co"># High risk rate of transmission</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4">  <span class="dt">gamma_H =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="co"># Rate of progression to active symptoms from high risk latent</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5">  <span class="dt">nu =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="co">#Rate of progression from high to low risk latent</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6">  <span class="dt">gamma_L =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">100</span>, <span class="co"># Rate of progression to active symptoms for low risk latent</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7">  <span class="dt">epsilon =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, <span class="co"># Rate of treatment</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8">  <span class="dt">tau =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, <span class="co"># Rate of recovery</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9">  <span class="dt">mu =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">81</span>, <span class="co"># Rate of natural mortality</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10">  <span class="dt">p =</span> <span class="fl">0.2</span>, <span class="co"># proportion of new births that are high risk</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11">  <span class="dt">M =</span> <span class="fl">0.2</span> <span class="co"># Between group mixing</span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12">)</a></code></pre></div>
</div>
<div id="equations-2" class="section level3">
<h3 class="hasAnchor">
<a href="#equations-2" class="anchor"></a>Equations</h3>
<p>Update the model equations using the model flow diagram above. The comments in the code given hints as to where changes need to be made. The equations for the low risk population have been provided for you.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">real_SHLIR_demo_ode &lt;-<span class="st"> </span><span class="cf">function</span>(t, x, params) {</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"></a>
<a class="sourceLine" id="cb17-3" data-line-number="3">  ## Specify model compartments </a>
<a class="sourceLine" id="cb17-4" data-line-number="4">  ## The compartments for the low risk population have been provided </a>
<a class="sourceLine" id="cb17-5" data-line-number="5">  ## Add the high risk population</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">  ## Don't forget to update indexing for x. Compare the previous two models for a hint.</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">  S &lt;-<span class="st"> </span>x[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">  H &lt;-<span class="st"> </span>x[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb17-9" data-line-number="9">  L &lt;-<span class="st"> </span>x[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb17-10" data-line-number="10">  I &lt;-<span class="st"> </span>x[<span class="dv">4</span>]</a>
<a class="sourceLine" id="cb17-11" data-line-number="11">  Tr &lt;-<span class="st"> </span>x[<span class="dv">5</span>]</a>
<a class="sourceLine" id="cb17-12" data-line-number="12">  R &lt;-<span class="st"> </span>x[<span class="dv">6</span>]</a>
<a class="sourceLine" id="cb17-13" data-line-number="13">  </a>
<a class="sourceLine" id="cb17-14" data-line-number="14">  S_H &lt;-<span class="st"> </span>x[<span class="dv">7</span>]</a>
<a class="sourceLine" id="cb17-15" data-line-number="15">  H_H &lt;-<span class="st"> </span>x[<span class="dv">8</span>]</a>
<a class="sourceLine" id="cb17-16" data-line-number="16">  L_H &lt;-<span class="st"> </span>x[<span class="dv">9</span>]</a>
<a class="sourceLine" id="cb17-17" data-line-number="17">  I_H &lt;-<span class="st"> </span>x[<span class="dv">10</span>]</a>
<a class="sourceLine" id="cb17-18" data-line-number="18">  Tr_H &lt;-<span class="st"> </span>x[<span class="dv">11</span>]</a>
<a class="sourceLine" id="cb17-19" data-line-number="19">  R_H &lt;-<span class="st"> </span>x[<span class="dv">12</span>]</a>
<a class="sourceLine" id="cb17-20" data-line-number="20"></a>
<a class="sourceLine" id="cb17-21" data-line-number="21">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/with">with</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">as.list</a></span>(params),{</a>
<a class="sourceLine" id="cb17-22" data-line-number="22"></a>
<a class="sourceLine" id="cb17-23" data-line-number="23">    ## Specify total population</a>
<a class="sourceLine" id="cb17-24" data-line-number="24">    N =<span class="st"> </span>S <span class="op">+</span><span class="st"> </span>H <span class="op">+</span><span class="st"> </span>L <span class="op">+</span><span class="st"> </span>I <span class="op">+</span><span class="st"> </span>Tr <span class="op">+</span><span class="st"> </span>R <span class="op">+</span><span class="st"> </span>S_H <span class="op">+</span><span class="st"> </span>H_H <span class="op">+</span><span class="st"> </span>L_H <span class="op">+</span><span class="st"> </span>I_H <span class="op">+</span><span class="st"> </span>Tr_H <span class="op">+</span><span class="st"> </span>R_H</a>
<a class="sourceLine" id="cb17-25" data-line-number="25"></a>
<a class="sourceLine" id="cb17-26" data-line-number="26">    ## Force of infection</a>
<a class="sourceLine" id="cb17-27" data-line-number="27">    ## The force of infetion in the low risk population has been provided for you</a>
<a class="sourceLine" id="cb17-28" data-line-number="28">    foi &lt;-<span class="st"> </span>beta  <span class="op">*</span><span class="st"> </span>I <span class="op">/</span><span class="st"> </span>N <span class="op">+</span><span class="st"> </span>M <span class="op">*</span><span class="st"> </span>beta_H <span class="op">*</span><span class="st"> </span>I_H <span class="op">/</span><span class="st"> </span>N </a>
<a class="sourceLine" id="cb17-29" data-line-number="29">    ## Add the high risk force of infection here</a>
<a class="sourceLine" id="cb17-30" data-line-number="30">    foi_H &lt;-<span class="st">  </span>M <span class="op">*</span><span class="st"> </span>beta  <span class="op">*</span><span class="st"> </span>I <span class="op">/</span><span class="st"> </span>N <span class="op">+</span><span class="st">  </span>beta_H <span class="op">*</span><span class="st"> </span>I_H <span class="op">/</span><span class="st"> </span>N </a>
<a class="sourceLine" id="cb17-31" data-line-number="31">    </a>
<a class="sourceLine" id="cb17-32" data-line-number="32">    ## Derivative Expressions</a>
<a class="sourceLine" id="cb17-33" data-line-number="33">    ## General population - provided for you</a>
<a class="sourceLine" id="cb17-34" data-line-number="34">    ## Compare these equations from those used for the previous models</a>
<a class="sourceLine" id="cb17-35" data-line-number="35">    dS =<span class="st"> </span><span class="op">-</span>S <span class="op">*</span><span class="st"> </span>foi <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>S <span class="op">+</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p) <span class="op">*</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>N</a>
<a class="sourceLine" id="cb17-36" data-line-number="36">    dH =<span class="st"> </span>(S <span class="op">+</span><span class="st"> </span>L <span class="op">+</span><span class="st"> </span>R) <span class="op">*</span><span class="st"> </span>foi <span class="op">-</span><span class="st"> </span>gamma_H <span class="op">*</span><span class="st"> </span>H <span class="op">-</span><span class="st"> </span>nu <span class="op">*</span><span class="st"> </span>H <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>H</a>
<a class="sourceLine" id="cb17-37" data-line-number="37">    dL =<span class="st"> </span>nu <span class="op">*</span><span class="st"> </span>H <span class="op">-</span><span class="st"> </span>L <span class="op">*</span><span class="st"> </span>foi <span class="op">-</span><span class="st"> </span>gamma_L <span class="op">*</span><span class="st"> </span>L <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>L</a>
<a class="sourceLine" id="cb17-38" data-line-number="38">    dI =<span class="st"> </span>gamma_H <span class="op">*</span><span class="st"> </span>H <span class="op">+</span><span class="st"> </span>gamma_L <span class="op">*</span><span class="st"> </span>L <span class="op">-</span><span class="st"> </span>epsilon <span class="op">*</span><span class="st"> </span>I <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>I</a>
<a class="sourceLine" id="cb17-39" data-line-number="39">    dTr =<span class="st"> </span>epsilon <span class="op">*</span><span class="st"> </span>I <span class="op">-</span><span class="st"> </span>tau <span class="op">*</span><span class="st"> </span>Tr <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>Tr</a>
<a class="sourceLine" id="cb17-40" data-line-number="40">    dR =<span class="st"> </span>tau <span class="op">*</span><span class="st"> </span>Tr <span class="op">-</span><span class="st"> </span>R <span class="op">*</span><span class="st"> </span>foi <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>R</a>
<a class="sourceLine" id="cb17-41" data-line-number="41">    </a>
<a class="sourceLine" id="cb17-42" data-line-number="42">    ## High risk population</a>
<a class="sourceLine" id="cb17-43" data-line-number="43">    ## Copy the equations used above for the low risk population</a>
<a class="sourceLine" id="cb17-44" data-line-number="44">    ## Convert them to be in the high risk population</a>
<a class="sourceLine" id="cb17-45" data-line-number="45">    dS_H =<span class="st"> </span><span class="op">-</span>S_H <span class="op">*</span><span class="st"> </span>foi_H <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>S_H <span class="op">+</span><span class="st"> </span>p <span class="op">*</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>N</a>
<a class="sourceLine" id="cb17-46" data-line-number="46">    dH_H =<span class="st"> </span>(S_H <span class="op">+</span><span class="st"> </span>L_H <span class="op">+</span><span class="st"> </span>R_H) <span class="op">*</span><span class="st"> </span>foi_H <span class="op">-</span><span class="st"> </span>gamma_H <span class="op">*</span><span class="st"> </span>H_H <span class="op">-</span><span class="st"> </span>nu <span class="op">*</span><span class="st"> </span>H_H <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>H_H</a>
<a class="sourceLine" id="cb17-47" data-line-number="47">    dL_H =<span class="st"> </span>nu <span class="op">*</span><span class="st"> </span>H_H <span class="op">-</span><span class="st"> </span>L_H <span class="op">*</span><span class="st"> </span>foi_H <span class="op">-</span><span class="st"> </span>gamma_L <span class="op">*</span><span class="st"> </span>L_H <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>L_H</a>
<a class="sourceLine" id="cb17-48" data-line-number="48">    dI_H =<span class="st"> </span>gamma_H <span class="op">*</span><span class="st"> </span>H_H <span class="op">+</span><span class="st"> </span>gamma_L <span class="op">*</span><span class="st"> </span>L_H <span class="op">-</span><span class="st"> </span>epsilon <span class="op">*</span><span class="st"> </span>I_H <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>I_H</a>
<a class="sourceLine" id="cb17-49" data-line-number="49">    dTr_H =<span class="st"> </span>epsilon <span class="op">*</span><span class="st"> </span>I_H <span class="op">-</span><span class="st"> </span>tau <span class="op">*</span><span class="st"> </span>Tr_H <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>Tr_H</a>
<a class="sourceLine" id="cb17-50" data-line-number="50">    dR_H =<span class="st"> </span>tau <span class="op">*</span><span class="st"> </span>Tr_H <span class="op">-</span><span class="st"> </span>R_H <span class="op">*</span><span class="st"> </span>foi_H <span class="op">-</span><span class="st"> </span>mu <span class="op">*</span><span class="st"> </span>R_H</a>
<a class="sourceLine" id="cb17-51" data-line-number="51"></a>
<a class="sourceLine" id="cb17-52" data-line-number="52">    ## output</a>
<a class="sourceLine" id="cb17-53" data-line-number="53">    derivatives &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(dS, dH, dL, dI, dTr, dR, dS_H, dH_H, dL_H, dI_H, dTr_H, dR_H)</a>
<a class="sourceLine" id="cb17-54" data-line-number="54"></a>
<a class="sourceLine" id="cb17-55" data-line-number="55">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(derivatives)</a>
<a class="sourceLine" id="cb17-56" data-line-number="56">  })</a>
<a class="sourceLine" id="cb17-57" data-line-number="57">}</a></code></pre></div>
</div>
<div id="simulate-and-summarise-2" class="section level3">
<h3 class="hasAnchor">
<a href="#simulate-and-summarise-2" class="anchor"></a>Simulate and Summarise</h3>
<p>Simulate the new model as previously.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">begin_time &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">end_time &lt;-<span class="st"> </span><span class="dv">200</span></a>
<a class="sourceLine" id="cb18-3" data-line-number="3">real_SHLIR_times &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(begin_time, end_time, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb18-4" data-line-number="4"></a>
<a class="sourceLine" id="cb18-5" data-line-number="5">## see ?solve_ode for details</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">real_SHLIR_sim &lt;-<span class="st"> </span>biddmodellingcourse<span class="op">::</span><span class="kw"><a href="https://bristolmathmodellers.github.io/biddmodellingcourse//reference/solve_ode.html">solve_ode</a></span>(<span class="dt">model =</span> real_SHLIR_demo_ode, </a>
<a class="sourceLine" id="cb18-7" data-line-number="7">                                           <span class="dt">inits =</span> real_SHLIR_inits, </a>
<a class="sourceLine" id="cb18-8" data-line-number="8">                                           <span class="dt">params =</span> real_SHLIR_parameters,</a>
<a class="sourceLine" id="cb18-9" data-line-number="9">                                           <span class="dt">times =</span> real_SHLIR_times, </a>
<a class="sourceLine" id="cb18-10" data-line-number="10">                                           <span class="dt">as.data.frame =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb18-11" data-line-number="11">real_SHLIR_sim <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="st">  </span>head <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="../reference/pretty_table.html">pretty_table</a></span>(<span class="dt">caption =</span> <span class="st">"First 5 years of model simulation"</span>,</a>
<a class="sourceLine" id="cb18-14" data-line-number="14">               <span class="dt">label =</span> <span class="st">"tab-real_SHLIR"</span>)</a></code></pre></div>
<table class="table">
<caption>Table 4: First 5 years of model simulation (continued below)</caption>
<colgroup>
<col width="9%">
<col width="10%">
<col width="12%">
<col width="12%">
<col width="13%">
<col width="14%">
<col width="16%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="center">time</th>
<th align="center">S</th>
<th align="center">H</th>
<th align="center">L</th>
<th align="center">I</th>
<th align="center">Tr</th>
<th align="center">R</th>
<th align="center">S_H</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">800</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">199</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">799.1</td>
<td align="center">0.6388</td>
<td align="center">0.1786</td>
<td align="center">0.06452</td>
<td align="center">0.006904</td>
<td align="center">0.0009364</td>
<td align="center">198</td>
</tr>
<tr class="odd">
<td align="center">2</td>
<td align="center">798.1</td>
<td align="center">1.048</td>
<td align="center">0.5935</td>
<td align="center">0.1941</td>
<td align="center">0.03844</td>
<td align="center">0.01108</td>
<td align="center">197.1</td>
</tr>
<tr class="even">
<td align="center">3</td>
<td align="center">796.8</td>
<td align="center">1.477</td>
<td align="center">1.201</td>
<td align="center">0.3596</td>
<td align="center">0.09632</td>
<td align="center">0.04336</td>
<td align="center">196.3</td>
</tr>
<tr class="odd">
<td align="center">4</td>
<td align="center">795.1</td>
<td align="center">2.002</td>
<td align="center">2.027</td>
<td align="center">0.5632</td>
<td align="center">0.1794</td>
<td align="center">0.1102</td>
<td align="center">195.5</td>
</tr>
<tr class="even">
<td align="center">5</td>
<td align="center">792.9</td>
<td align="center">2.658</td>
<td align="center">3.121</td>
<td align="center">0.8155</td>
<td align="center">0.2889</td>
<td align="center">0.2236</td>
<td align="center">194.6</td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col width="12%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="center">H_H</th>
<th align="center">L_H</th>
<th align="center">I_H</th>
<th align="center">Tr_H</th>
<th align="center">R_H</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">0.7367</td>
<td align="center">0.2138</td>
<td align="center">0.785</td>
<td align="center">0.2257</td>
<td align="center">0.06372</td>
</tr>
<tr class="odd">
<td align="center">0.9991</td>
<td align="center">0.6472</td>
<td align="center">0.7108</td>
<td align="center">0.3277</td>
<td align="center">0.2031</td>
</tr>
<tr class="even">
<td align="center">1.106</td>
<td align="center">1.153</td>
<td align="center">0.6904</td>
<td align="center">0.3781</td>
<td align="center">0.3761</td>
</tr>
<tr class="odd">
<td align="center">1.169</td>
<td align="center">1.684</td>
<td align="center">0.6935</td>
<td align="center">0.4067</td>
<td align="center">0.565</td>
</tr>
<tr class="even">
<td align="center">1.228</td>
<td align="center">2.23</td>
<td align="center">0.7103</td>
<td align="center">0.4267</td>
<td align="center">0.7623</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">biddmodellingcourse<span class="op">::</span><span class="kw"><a href="https://bristolmathmodellers.github.io/biddmodellingcourse//reference/summarise_model.html">summarise_model</a></span>(real_SHLIR_sim) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/pretty_table.html">pretty_table</a></span>(<span class="dt">caption =</span> <span class="st">"Realistic SHLIR model summary statistics; The final size of each population at the end of the simulation, along with the time the epidemic peak was reached, the number of infected at the epidemic peak and the duration of the epidemic"</span>)</a></code></pre></div>
<table class="table">
<caption>Table 5: Realistic SHLIR model summary statistics; The final size of each population at the end of the simulation, along with the time the epidemic peak was reached, the number of infected at the epidemic peak and the duration of the epidemic (continued below)</caption>
<colgroup>
<col width="19%">
<col width="19%">
<col width="19%">
<col width="19%">
<col width="20%">
</colgroup>
<thead><tr class="header">
<th align="center">Final size: S</th>
<th align="center">Final size: H</th>
<th align="center">Final size: L</th>
<th align="center">Final size: I</th>
<th align="center">Final size: Tr</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">22</td>
<td align="center">218</td>
<td align="center">242</td>
<td align="center">133</td>
<td align="center">87</td>
</tr></tbody>
</table>
<table class="table">
<caption>Table continues below</caption>
<colgroup>
<col width="22%">
<col width="25%">
<col width="25%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th align="center">Final size: R</th>
<th align="center">Final size: S_H</th>
<th align="center">Final size: H_H</th>
<th align="center">Final size: L_H</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">98</td>
<td align="center">10</td>
<td align="center">39</td>
<td align="center">77</td>
</tr></tbody>
</table>
<table class="table">
<caption>Table continues below</caption>
<colgroup>
<col width="23%">
<col width="25%">
<col width="23%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th align="center">Final size: I_H</th>
<th align="center">Final size: Tr_H</th>
<th align="center">Final size: R_H</th>
<th align="center">Epidemic peak time</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">25</td>
<td align="center">16</td>
<td align="center">33</td>
<td align="center">74</td>
</tr></tbody>
</table>
<table class="table">
<colgroup>
<col width="22%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th align="center">Epidemic peak</th>
<th align="center">Epidemic duration</th>
</tr></thead>
<tbody><tr class="odd">
<td align="center">133</td>
<td align="center">0</td>
</tr></tbody>
</table>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">## For an interactive graph change interactive to TRUE</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">biddmodellingcourse<span class="op">::</span><span class="kw"><a href="https://bristolmathmodellers.github.io/biddmodellingcourse//reference/plot_model.html">plot_model</a></span>(real_SHLIR_sim, <span class="dt">interactive =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<div class="figure" style="text-align: center">
<img src="solutions-three_files/figure-html/real-SHLIR-plot-1.png" alt="Figure 4: Plot of population over time in each realistic SHLIR model compartment" width="2310"><p class="caption">
Figure 4: Plot of population over time in each realistic SHLIR model compartment
</p>
</div>
</div>
<div id="explore-2" class="section level3">
<h3 class="hasAnchor">
<a href="#explore-2" class="anchor"></a>Explore</h3>
<ol style="list-style-type: decimal">
<li>
<p>Test your changes by setting all the parameters to be the same as in the SHLIR model.</p>
<ul>
<li><strong>The models should give the same results.</strong></li>
</ul>
</li>
<li><p>Can you alter the parameters defined above to answer the questions for this model from practical 2?</p></li>
</ol>
<p>##4. Implement Your Own Model</p>
<p>Using the same structure as used in models above implement your own model into R. Talk to the instructors for tips, tricks, and potential ideas. See the <code>idmodelr</code> package for other example model structures (<a href="https://www.samabbott.co.uk/idmodelr/" class="uri">https://www.samabbott.co.uk/idmodelr/</a>). It may help to first draw out the flow diagram for your model (potentially writing out the equations may also help).</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#learning-objectives">Learning Objectives</a></li>
      <li><a href="#outline-for-session">Outline for Session</a></li>
      <li><a href="#solutions">Solutions</a></li>
      <li><a href="#exercise">Exercise</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Sam Abbott, Josephine Walker.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
